<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Maveric 2D Shooter HTML5 Game</title>
    <style>
      * { padding: 0; margin: 0; }
      canvas { image-rendering: pixelated; background: #eee; display: block; margin: 0 auto; }
    </style>
  </head>
  <body>
    <canvas id="maveric" width="800" height="600"></canvas>
    <script src="https://github.com/liabru/matter-js/releases/download/0.9.0/matter.min.js"></script>

    <script>
      var floorColor = "rgba(150,0,150,1)";
      var wallColor = "rgba(150,150,150,.9)";
      var worldObjects = [];
      var mapSize = 50;
      for(var i = 0; i < mapSize*mapSize; ++i) {
        worldObjects.push({size:30, x:(i%mapSize), y: (Math.floor(i/mapSize)), asset:"floor", fill: floorColor});
      }
      var randomI = Math.floor(Math.random()*mapSize);
      for(var i = 0; i < 100; ++i) {
        worldObjects.push({size:30, asset: "wall", fill: wallColor, x: (randomI%mapSize), y: (Math.floor(randomI/mapSize))});
        randomI += Math.floor(Math.random()*mapSize);
      }
      var assets = { 
        'floor': {'image': function(obj, ctx) {
          var size = obj.size;
          var half = size*.5;
          ctx.resetTransform();
          ctx.scale(1, .5);
          ctx.rotate(Math.PI/4);
          ctx.translate(200,50);
          ctx.translate(obj.x*size, obj.y*size);
          ctx.translate(half, half);

          ctx.fillStyle=obj.fill;
          ctx.strokeStyle="black";
          ctx.fillRect(-half,-half,size,size);
        }},
        'wall': {'image': function(obj, ctx) {
          assets['floor'].image(obj, ctx);
          var size = obj.size;
          var half = size*.5;
          ctx.translate(-size, -size);

          ctx.fillStyle=obj.fill;
          ctx.strokeStyle="silver";
          ctx.fillRect(-half,-half,size,size);
          ctx.transform(1, 0, 1, 1, 0, 0);
          ctx.fillRect(-size,half,size,size);

          ctx.resetTransform();
          ctx.scale(1, .5);
          ctx.rotate(Math.PI/4);
          ctx.translate(200,50);
          ctx.translate(obj.x*size, obj.y*size);
          ctx.translate(-size, -size);
          ctx.transform(1, 1, 0, 1, 0, 0);
          ctx.fillRect(size,-size,size,size);
          assets['floor'].image(obj, ctx);
        }}
      };
      var gameError = false;
      var ctx;
      function loadImage(image, callback) {
        if(!isF(image)){
          var imgTag = document.createElement('img');
          imgTag.src = image;
          imgTag.onerror = errorGame;
          imgTag.onload = callback;
        }else{
          callback.bind(image).call();
          return image;
        }
      }
      function isF(functionToCheck) {
        var getType = {};
        return functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';
      }
      function game() {
        var canvas = document.getElementById('maveric');
        ctx = canvas.getContext('2d');
        loadGame();
      }
      function loadGame() {
        var loaded = true;
        for(var asset in assets) {
          if(assets.hasOwnProperty(asset)) {
            if(assets[asset].loaded === undefined) {
              loaded = false;
              if(assets[asset].loading === undefined) {
                loadImage(assets[asset].image, function() {
                  assets[asset].loaded = true;
                  assets[asset].img = this;
                });
                assets[asset].loading = true;
              }
            }
          }
        }
        if(!loaded) {
          setTimeout(loadGame, 10);
        }else{
          setTimeout(startLevel1, 10);
        }
      }
      function drawAsset(ctx, obj) {
        var asset = obj.asset;
        if(isF(assets[asset].img)) {
          assets[asset].img.call(this, obj, ctx);
        }else{
          ctx.drawImage(assets[asset].img, 0, 0);
        }
      }
      function startLevel1() {
        ctx.fillStyle = "#ff0000";
        for(var i = 0; i < worldObjects.length; ++i) {
          drawAsset(ctx, worldObjects[i]);
        }
      }
      function errorGame() {
        gameError = true;
      }
      window.onload = game;
    </script>
  </body>
</html>
