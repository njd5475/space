<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Maveric 2D Shooter HTML5 Game</title>
    <style>
      * { padding: 0; margin: 0; }
      canvas { image-rendering: pixelated; background: #eee; display: block; margin: 0 auto; }
    </style>
  </head>
  <body>
    <canvas id="maveric" width="800" height="600"></canvas>
    <script src="https://github.com/liabru/matter-js/releases/download/0.9.0/matter.min.js"></script>

    <script>
      var worldObjects = [
        {size:20, x:4, y:4,asset: 'floor'}, 
        {size:20, x:4, y:3,asset: 'wall'}
      ];
      var assets = { 
        'floor': {'image': function(obj, ctx) {
          var size = obj.size;
          var half = size*.5;

          ctx.translate(obj.x*size, obj.y*size*.71);
          ctx.translate(half, size);
          ctx.scale(1, .5);
          ctx.rotate(Math.PI/4);

          ctx.fillStyle="gray";
          ctx.strokeStyle="silver";
          ctx.fillRect(-half,-half,size,size);
          ctx.resetTransform();
        }},
        'wall': {'image': function(obj, ctx) {
          assets['floor'].image(obj,ctx);
          ctx.translate(0, -obj.size*0.5);
          assets['floor'].image(obj, ctx);

          var size = obj.size;
          var half = size*.5;
          ctx.fillStyle="darkgray";
          var sx = 0;
          var sy = 0.5;
          ctx.translate(obj.x*size, obj.y*size*.71);
          ctx.translate(half, size);
          ctx.scale(1, .5);
          ctx.rotate(Math.PI/4);

          ctx.transform(1, sy, sx, 1, 0, 0);
          ctx.fillRect(size,half,half,half);
          sx = 0;
          sy = -0.5;
          ctx.resetTransform();
          ctx.translate(obj.x*size, obj.y*size);
          ctx.transform(1, sy, sx, 1, 0, 0);
          ctx.fillRect(size-20,half+4,half+8,half);
        }}
      };
      var gameError = false;
      var ctx;
      function loadImage(image, callback) {
        if(!isF(image)){
          var imgTag = document.createElement('img');
          imgTag.src = image;
          imgTag.onerror = errorGame;
          imgTag.onload = callback;
        }else{
          callback.bind(image).call();
          return image;
        }
      }
      function isF(functionToCheck) {
        var getType = {};
        return functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';
      }
      function game() {
        var canvas = document.getElementById('maveric');
        ctx = canvas.getContext('2d');
        loadGame();
      }
      function loadGame() {
        var loaded = true;
        for(var asset in assets) {
          if(assets.hasOwnProperty(asset)) {
            if(assets[asset].loaded === undefined) {
              loaded = false;
              if(assets[asset].loading === undefined) {
                loadImage(assets[asset].image, function() {
                  assets[asset].loaded = true;
                  assets[asset].img = this;
                });
                assets[asset].loading = true;
              }
            }
          }
        }
        if(!loaded) {
          setTimeout(loadGame, 10);
        }else{
          setTimeout(startLevel1, 10);
        }
      }
      function drawAsset(ctx, obj) {
        var asset = obj.asset;
        if(isF(assets[asset].img)) {
          assets[asset].img.call(this, obj, ctx);
        }else{
          ctx.drawImage(assets[asset].img, 0, 0);
        }
      }
      function startLevel1() {
        ctx.fillStyle = "#ff0000";
        for(var i = 0; i < worldObjects.length; ++i) {
          drawAsset(ctx, worldObjects[i]);
        }
      }
      function errorGame() {
        gameError = true;
      }
      window.onload = game;
    </script>
  </body>
</html>
